<!--
`juicy-tile-list element` - masonry-like Custom Element for sortable tiles that packs efficiently without changing HTML structure (changes CSS only).

@element juicy-tile-list
@demo https://Juicy.github.io/juicy-tile-list/
version: 1.1.0
--><script src="rectangle.js"></script><script src="packer.js"></script><script src="package.js"></script><template id="juicy-tile"><div class="juicy-tile"><content></content></div></template><template id="juicy-tile-list"><style>:host{display:block}#container{position:relative;z-index:0}polyfill-next-selector{content:':host #container> .juicy-tile'}.juicy-tile{position:absolute;display:inline-block}polyfill-next-selector{content:':host #container> .containerBackground'}.containerBackground{position:absolute;z-index:-1}</style><div id="container" class="animate"></div></template><script>!function(){function e(e){var t=e.offsetWidth,i=window.getComputedStyle(e,null),r=parseFloat(i.getPropertyValue("border-left"))||0,n=parseFloat(i.getPropertyValue("border-right"))||0,s=parseFloat(i.getPropertyValue("padding-left"))||0,a=parseFloat(i.getPropertyValue("padding-right"))||0;return t-r-n-s-a}function t(e){var t=e.offsetHeight,i=window.getComputedStyle(e,null),r=parseFloat(i.getPropertyValue("border-top"))||0,n=parseFloat(i.getPropertyValue("border-bottom"))||0,s=parseFloat(i.getPropertyValue("padding-top"))||0,a=parseFloat(i.getPropertyValue("padding-bottom"))||0;return t-r-n-s-a}function i(e,t){return Array.prototype.slice.call(t).filter(function(t){return t instanceof Text&&t.data.trim()&&console.error("juicy-tile-list can only render DOM element nodes. Provided input contains a text node which cannot be rendered. Wrap it in a <div> to fix the problem. Problematic text node: ",t," (",e.getAttribute("name"),")"),!(t instanceof Text||t instanceof HTMLLinkElement||t instanceof HTMLStyleElement||t instanceof HTMLTemplateElement||"PUPPET-MORPHURL"==t.nodeName||t instanceof HTMLScriptElement||t instanceof Comment)})}function r(e,t,i,r){for(var s=0,a=e.length;a>s;s++){var o=e[s];if(!i[o.id]){var h=JSON.parse(JSON.stringify(r));h.priority=0==t.length?.5:n(t)*(1-1/a),h.id=o.id,Object.defineProperty(h,"container",{value:i.root,writable:!0}),t.push(h),i[o.id]=h}}}function n(e){for(var t=1,i=0,r=e.length;r>i;i++)e[i].priority<t&&(t=e[i].priority);return 0>t&&(t=0),t}function s(e,t){var i=e;for(i=i.parentNode;i&&"BODY"!=i.tagName;){if(i.tagName==e.tagName){i.addEventListener("juicy-tile-list-refresh",t);break}i=i.parentNode}}function a(e,t){var i=e;for(i=i.parentNode;i&&"BODY"!=i.tagName;){if(i.tagName==e.tagName){i.removeEventListener("juicy-tile-list-refresh",t);break}i=i.parentNode}}function o(e,t){t.shadowContainer.children.length&&(t.shadowContainer.innerHTML="");for(var i,r,n,s,a=[],o="",h=0,l=document.createDocumentFragment(),d=0,c=e.length;c>d;d++)n=e[d],"JUICY-TILE-GROUP"!==n.tagName?(s=o+h,h++,i=document.importNode(u,!0),r=i.children[0],r.id=s,r.firstChild.setAttribute("select","[juicytile='"+s+"']"),l.appendChild(i),n.setAttribute("juicytile",s),a.push(r),a[s]=r):(o=n.getAttribute("name")||"",o+="/",h=0);return t.shadowContainer.appendChild(l),a.root=t.shadowContainer,a}function h(e,t,i,r,n){for(var s,a,o,l,d,u,c=e.items.length;c--;)if(s=e.items[c],a=t[s.id]){if(o=a.style,u=n||s.hidden)o.display="none";else{o.display="",l=e.rightToLeft?e.width-s.width-s.x:s.x||0,l+=i,d=e.bottomUp?e.height-s.height-s.y:s.y||0,d+=r;var p=s.oversize||0;o.left=l+"px",o.top=d+"px",o.width=s.width+"px",o.height=s.height+"px",o.backgroundColor=void 0!==s.background?s.background||"transparent":"",o.outline=s.outline||"",p?(o.padding=p+"px",o.margin="-"+p+"px"):(o.padding="",o.margin="")}s.items&&h(s,t,l,d,u)}}function l(e,t){return e&&t&&Object.getOwnPropertyNames(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);r&&(Object.defineProperty(e,i,r),"function"==typeof r.value&&(r.value.nom=i))}),e}var d=(document._currentScript||document.currentScript).ownerDocument,u=d.getElementById("juicy-tile").content,c=d.getElementById("juicy-tile-list"),p={width:256,height:128,priority:0},f=l(HTMLElement.prototype,Package.prototype),g=Object.create(f),m=g;m.elements=null,m.tiles=null,m.allItems=null,m.duration=.5,m.refreshOnMutation=!1,m.refreshOnResize=!1,m.refreshOnAttached=!0,m.defaultTileSetup=p,m.createdCallback=function(){this.setup={};var e=this;this.observer=new MutationObserver(function(t){if(e.isReady){var i=!1;t.forEach(function(e){(e.addedNodes.length||e.removedNodes.length)&&(i=!0)}),i&&(e.allItems=null,Package.call(e,e.setup),e.createItemsList(),e.refresh(!0))}}),this.refresh=this.refresh.bind(this)},m.sorter=function(e,t){return t.priority-e.priority},m.updateWrappers=o,m.createItemsList=function(){this.elements=i(this,this.childNodes),this.tiles=this.updateWrappers(this.elements,this),r(this.tiles,this.setup.items,this.allItems,this.defaultTileSetup)},m.attachedCallback=function(){var e=this.createShadowRoot(),t=c,i=document.importNode(t.content,!0);e.appendChild(i),this.shadowContainer=e.querySelector("#container"),this.attributeChangedCallback("refreshonresize",!1,this.getBooleanAttribute("refreshonresize",!1)),this.attributeChangedCallback("refreshonmutation",!1,this.getBooleanAttribute("refreshonmutation",!1)),this.attributeChangedCallback("refreshonattached",!0,this.getBooleanAttribute("refreshonattached",!0)),this.attributeChangedCallback("defaulttilesetup",null,this.getAttribute("defaulttilesetup")),this.attributeChangedCallback("setup",null,this.getAttribute("setup")),Package.call(this,this.setup&&void 0!==this.setup.items?this.setup:void 0),void 0!=this.gutter&&(this.setup.gutter=parseInt(this.gutter,10)),this.createItemsList(),this.refreshOnResize&&this.addResizeListeners(),this.refreshOnAttached&&setTimeout(function(){this.refresh()}.bind(this)),this.refreshOnMutation&&this.observer.observe(this,{childList:!0}),this.isReady=!0},m.detachedCallback=function(){this.observer.disconnect(),this.isReady=!1},m.addResizeListeners=function(){document.attachEvent?this.attachEvent("onresize",this.refresh):s(this,this.refresh),window.addEventListener("resize",this.refresh,!0)},m.removeResizeListeners=function(){document.attachEvent?this.detachEvent("onresize",this.refresh):a(this,this.refresh),window.removeEventListener("resize",this.refresh,!0)},m.deleteContainer=function(e,t){var i=Package.prototype.deleteContainer.call(this,e,t),r=this.tiles[i.id];return r.parentNode.removeChild(r),i},m.cleanupDOM=function(){for(var e=this.shadowContainer.querySelectorAll(".containerBackground"),t=0,i=e.length;i>t;t++)e[t].parentNode.removeChild(e[t])},m.packItems=function(e){e||(e=this.setup);var t=this.tiles;if(t)for(var i,r,n=e.items.length;n--;)if(i=e.items[n],r=t[i.id],void 0!==i.items&&(r?r.parentElement||this.shadowContainer.appendChild(r):(r=document.createElement("DIV"),r.className="containerBackground",t[i.id]=r,r.id=i.id,this.shadowContainer.appendChild(r)),void 0!=i.content&&(r.innerHTML=i.content)),r&&!i.items){var s=r.style.padding;r.style.padding="",i.precalculateWidth&&(r.style.width="",i.width=r.scrollWidth),i.precalculateHeight&&(i.precalculateWidth||(r.style.width="string"==typeof i.width?i.width:i.width+"px"),r.style.height="",i.height=r.scrollHeight),r.style.padding=s}return Package.prototype.packItems.call(this,e)},m.refresh=function(i){i&&(this.tiles=this.updateWrappers(this.elements,this)),this.setup||(this.setup={items:[]}),"vertical"!=this.setup.direction?(this.setup.width=this.setup.width||e(this),this.setup.precalculateHeight=!0):(this.setup.height=this.setup.height||t(this),this.setup.precalculateWidth=!0);var r=this.packItems();this.renderer(r,this.tiles,0,0),this.dispatchEvent(new CustomEvent("juicy-tile-list-refresh"))},m.setupChanged=function(e,t,i,n){this.isReady&&(this.cleanupDOM(),Package.call(this,this.setup),r(this.tiles,this.setup.items,this.allItems,this.defaultTileSetup),this.refresh(n))},m.getBooleanAttribute=function(e,t){var i=this.getAttribute(e);return i&&"false"===i.toLowerCase()?!1:this.hasAttribute(e)||t},m.isPoolymerBinding=function(e){return/[{][{]/gi.test(e)},m.attributeChangedCallback=function(e,t,i){switch(e){case"refreshonattached":this.refreshOnAttached=this.getBooleanAttribute(e,!0);break;case"refreshonmutation":this.refreshOnMutation=this.getBooleanAttribute(e,!1),this.refreshOnMutation?this.observer.observe(this,{childList:!0}):this.observer.disconnect();break;case"refreshonresize":this.refreshOnResize=this.getBooleanAttribute(e,!1),this.refreshOnResize?this.addResizeListeners():this.removeResizeListeners();break;case"setup":if(i&&"string"==typeof i){if(this.isPoolymerBinding(i))return;try{this.setup=JSON.parse(i)}catch(r){console.warn("Invalid JSON provided for setup\r\n",r,i)}}t!=i&&this.setupChanged(t,i);break;case"defaulttilesetup":if(i){if("string"==typeof i){if(this.isPoolymerBinding(i))return;try{this.defaultTileSetup=JSON.parse(i)}catch(r){console.warn("Invalid JSON provided for defaultTileSetup\r\n",r,i),this.defaultTileSetup=p}}}else this.defaultTileSetup=p}},m._getMinimumDimension=function(e,t,i){var r=[];if(e.length<1)throw new Error("I need at least one element");e.sort(function(e,i){return e[t]-i[t]}),r.push({start:e[0][t],end:e[0][t]+e[0][i]});for(var n=1,s=e.length;s>n;n++){var a=r[r.length-1],o=e[n][t],h=e[n][t]+e[n][i];a.end<o?r.push({start:o,end:h}):a.end<h&&(a.end=h)}for(var l=0,n=0,s=r.length;s>n;n++)l+=r[n].end-r[n].start;return l},m.getMinimumDimensions=function(e){return{width:this._getMinimumDimension(e,"offsetLeft","offsetWidth"),height:this._getMinimumDimension(e,"offsetTop","offsetHeight")}},m.renderer=function(e,t,i,r){this.shadowContainer.style.width=e.width+"px",this.shadowContainer.style.height=e.height+"px",h(e,t,i,r)},m.bind=function(e,t,i){if("setup"===e||"defaultTileSetup"===e){var r=function(t){this[e]=t}.bind(this),n=t.open(r);r(n);var s={close:function(){t.close()}};return this[e+"Observer"]=s,s}return HTMLElement.prototype.bind.call(this,e,t,i)},window.JuicyTileList=document.registerElement("juicy-tile-list",{prototype:g})}();</script>