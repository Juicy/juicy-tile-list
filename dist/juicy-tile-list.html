<!--
`juicy-tile-list element` - masonry-like Polymer Element for sortable tiles that packs efficiently without changing HTML structure (changes CSS only).

@element juicy-tile-list
@demo https://Juicy.github.io/juicy-tile-list/
--><!-- Import Polymer --><script src="rectangle.js"></script><script src="packer.js"></script><script src="package.js"></script><!-- Define your custom element --><polymer-element name="juicy-tile-list" constructor="JuicyTileListElement" attributes="setup rowspans colspans layersOrientation defaultTileSetup"><template><style>:host{display:block;padding:16px}#container{position:relative}polyfill-next-selector{content:':host #container> *'}#container ::content>*,#container >*{position:absolute;z-index:2}polyfill-next-selector{content:':host #container.animate> *'}#container.animate ::content>*,#container.animate >*{-webkit-transition:width .5s,height .5s,top .5s,left .5s,-webkit-transform .5s;transition:width .5s ease-out,height .5s ease-out,top .5s ease-out,left .5s ease-out,transform .5s ease-out}#container{z-index:0}</style><div id="container" class="animate"><content></content></div></template><script>!function(){function t(t){var e=t.offsetWidth,i=window.getComputedStyle(t,null),n=parseFloat(i.getPropertyValue("border-left"))||0,r=parseFloat(i.getPropertyValue("border-right"))||0,o=parseFloat(i.getPropertyValue("padding-left"))||0,s=parseFloat(i.getPropertyValue("padding-right"))||0;return e-n-r-o-s}function e(t){var e=t.offsetHeight,i=window.getComputedStyle(t,null),n=parseFloat(i.getPropertyValue("border-top"))||0,r=parseFloat(i.getPropertyValue("border-bottom"))||0,o=parseFloat(i.getPropertyValue("padding-top"))||0,s=parseFloat(i.getPropertyValue("padding-bottom"))||0;return e-n-r-o-s}function i(t,e){t&&localStorage.setItem(t,e)}function n(t){return t?localStorage.getItem(t):void 0}function r(t){return t.array().filter(function(t){return!(t instanceof Text||t instanceof HTMLLinkElement||t instanceof HTMLStyleElement||t instanceof HTMLTemplateElement||"PUPPET-MORPHURL"==t.nodeName||t instanceof HTMLScriptElement)})}function o(t,e,i,n){for(var r=0,o=t.length;o>r;r++){{t[r]}if(!i[r]){var a=JSON.parse(JSON.stringify(n));a.priority=0==e.length?.5:s(e)*(1-1/o),a.index=r,Object.defineProperty(a,"container",{value:i.root,writable:!0}),e.push(a),i[r]=a}}}function s(t){for(var e=1,i=0,n=t.length;n>i;i++)t[i].priority<e&&(e=t[i].priority);return 0>e&&(e=0),e}function a(t,e){var i=t;for(i=i.parentNode;i&&"BODY"!=i.tagName;){if(i.tagName==t.tagName){i.addEventListener("juicy-tile-list-refresh",e);break}i=i.parentNode}}var h={width:256,height:128,priority:0};Polymer("juicy-tile-list",Platform.mixin({},Package.prototype,{setup:null,_storedSetup:null,elements:null,items:null,defaultTileSetup:h,sorter:function(t,e){return e.priority-t.priority},createItemsList:function(){this.elements=r(this.children),this.elements.root=this.$.container,o(this.elements,this.setup.items,this.items,this.defaultTileSetup)},domReady:function(){var t=this;document.attachEvent?this.attachEvent("onresize",this.refresh.bind(this,null,null)):a(this,this.async.bind(this,"refresh",[null,null],501)),window.addEventListener("resize",this.refresh.bind(this,null,null),!0),this.loadFromStorage();var e=new MutationObserver(function(e){e.forEach(function(i){console.log("observation",i.type,arguments,e),i.addedNodes&&(console.log("something was added"),t.createItemsList(),t.refresh())})});e.observe(this,{childList:!0})},deleteContainer:function(t,e){var i=Package.prototype.deleteContainer.call(this,t,e),n=this.elements[i.name];return n.parentNode.removeChild(n),i},cleanupDOM:function(){for(var t=this.$.container.querySelectorAll(".containerBackground"),e=0,i=t.length;i>e;e++)this.$.container.removeChild(t[e])},packItems:function(i){i||(i=this.setup);var n=this.elements;"downRight"!=this.setup.direction?(this.setup.width=t(this),this.setup.heightAuto=!0):(this.setup.height=e(this),this.setup.widthAuto=!0);for(var r,o=i.items.length;o--;){r=i.items[o];var s;n&&(void 0!==r.index?s=n[r.index]:void 0!==r.name&&(s=n[r.name],s||(s=document.createElement("DIV"),s.className="containerBackground",s.style.zIndex=-1,this.$.container.appendChild(s),n[r.name]=s),void 0!=r.innerHTML&&(s.innerHTML=r.innerHTML))),r.items||(r.widthAuto&&(s.style.width="",s.style["grid-row"]="",s.style["grid-column"]="",r.width=s.scrollWidth),r.heightAuto&&(r.widthAuto||(s.style.width=r.width+"px"),s.style.height="",r.height=s.scrollHeight))}return Package.prototype.packItems.call(this,i)},refresh:function(){var t=this.$.container,e=this.packItems();t.style.width=e.width+"px",t.style.height=e.height+"px",this.renderer(e,this.elements,0,0),this.dispatchEvent(new CustomEvent("juicy-tile-list-refresh"))},isModified:function(){return JSON.stringify(this.setup)!==this._storedSetup},saveToStorage:function(t){this._storedSetup=JSON.stringify(t||this.setup),i(this.id,this._storedSetup)},loadFromStorage:function(){this._storedSetup=n(this.id),this.loadFromString(this._storedSetup)},loadFromString:function(t){this.cleanupDOM(),t&&(this.setup=JSON.parse(t)),Package.call(this,this.setup),this.createItemsList(),this.refresh()},_getMinimumDimension:function(t,e,i){var n=[];if(t.length<1)throw new Error("I need at least one element");t.sort(function(t,i){return t[e]-i[e]}),n.push({start:t[0][e],end:t[0][e]+t[0][i]});for(var r=1,o=t.length;o>r;r++){var s=n[n.length-1],a=t[r][e],h=t[r][e]+t[r][i];s.end<a?n.push({start:a,end:h}):s.end<h&&(s.end=h)}for(var l=0,r=0,o=n.length;o>r;r++)l+=n[r].end-n[r].start;return l},getMinimumDimensions:function(t){return{width:this._getMinimumDimension(t,"offsetLeft","offsetWidth"),height:this._getMinimumDimension(t,"offsetTop","offsetHeight")}},renderer:function l(t,e,i,n){for(var r,o,s,a,h,u=t.items.length;u--;)if(r=t.items[u],o=e[r.name||r.index]){s=o.style,a=(r.x||0)+i,h=(r.y||0)+n;var d=r.oversize||0;s.left=a-d+"px",s.top=h-d+"px",s.width=r.width+2*d+"px",s.height=r.height+2*d+"px",void 0!==r.background&&(s.backgroundColor=r.background||"transparent"),r.items&&l(r,e,a,h)}}}))}();</script></polymer-element>