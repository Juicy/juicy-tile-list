<polymer-element name="pj-sortable-tiles-editor" attributes="sortableTilesId">
  <template>
    <style>
      div {
        padding: 10px;

      }

      label {
        display: inline-block;
        width: 90px;
      }

      input {
        width: 60px;
      }

      .disabled .editable {
        opacity: 0.5;
        pointer-events: none;
      }
    </style>
    <div class="{{ {disabled: !sortableTilesModel.editedItem} | tokenList }}">
      <div><label>Gap ({{sortableTilesModel.gap}})</label>
        <button class="editable" on-click="{{gapIncrease}}">Inc</button>
        <button class="editable" on-click="{{gapDecrease}}">Dec</button>
      </div>
      <div><label>Width ({{sortableTilesModel.editedItem.width}})</label>
        <button class="editable" on-click="{{widthIncrease}}">Inc</button>
        <button class="editable" on-click="{{widthDecrease}}">Dec</button>
      </div>
      <div><label>Height ({{sortableTilesModel.editedItem.height}})</label>
        <button class="editable" on-click="{{heightIncrease}}">Inc</button>
        <button class="editable" on-click="{{heightDecrease}}">Dec</button>
        <label class="editable"><input id="heightAutoCheckbox" type="checkbox" on-click="{{heightAuto}}"> auto</label>
      </div>
      <div><label>Priority ({{sortableTilesModel.editedItem.priority}})</label>
        <button class="editable" on-click="{{priorityIncrease}}">Inc</button>
        <button class="editable" on-click="{{priorityDecrease}}">Dec</button>
      </div>
      <div><label></label>
        <button on-click="{{close}}">Done</button>
      </div>
    </div>
  </template>
  <script>
    (function () {
      function powerIncrease(obj, property) {
        var power = 1;
        while (power <= obj[property])
            power *= 2;
        obj[property] = power;
      }
      
      function powerDecrease(obj, property, minimum) {
        var power = 1;
        while (power * 2 < obj[property])
          power *= 2;
        if (power < minimum) {
          power = minimum;
        }
        obj[property] = power;
      }

      Polymer('pj-sortable-tiles-editor', {
        sortableTilesModel: null,
        sortableTilesId: null,
        attached: function () {
          var that = this;
          window.addEventListener("pj-sortable-tiles-edited-item-changed", function(event) {
            that.sortableTilesModel = event.target;
          });
        },
        sortableTilesIdChanged: function() {
          this.sortableTilesModel = document.getElementById(this.sortableTilesId);
        },
        gapIncrease: function () {
          this.sortableTilesModel.gap++;
          this.sortableTilesModel.refresh();
        },
        gapDecrease: function () {
          if(this.sortableTilesModel.gap >= 1) {
            this.sortableTilesModel.gap--;
          }
          this.sortableTilesModel.refresh();
        },
        widthIncrease: function () {
          powerIncrease(this.sortableTilesModel.editedItem, "width");
          this.sortableTilesModel.refresh();
        },
        widthDecrease: function () {
          powerDecrease(this.sortableTilesModel.editedItem, "width");
          this.sortableTilesModel.refresh();
        },
        heightIncrease: function () {
          if(this.sortableTilesModel.editedItem.height == 'auto') { //turn off auto
            this.sortableTilesModel.editedItem.height = 32;
            this.shadowRoot.querySelector("#heightAutoCheckbox").checked = false;
          }
          powerIncrease(this.sortableTilesModel.editedItem, "height");
          this.sortableTilesModel.refresh();
        },
        heightDecrease: function () {
          if(this.sortableTilesModel.editedItem.height == 'auto') { //turn off auto
            this.sortableTilesModel.editedItem.height = 32;
            this.shadowRoot.querySelector("#heightAutoCheckbox").checked = false;
          }
          powerDecrease(this.sortableTilesModel.editedItem, "height");
          this.sortableTilesModel.refresh();
        },
        heightAuto: function () {
          if(this.sortableTilesModel.editedItem.height == 'auto') { //turn off auto
            this.sortableTilesModel.editedItem.height = 32;
          }
          else { //turn on auto
            this.sortableTilesModel.editedItem.height = "auto";
          }
          this.sortableTilesModel.refresh();
        },
        priorityIncrease: function () {
          this.sortableTilesModel.reprioritizeItem(this.sortableTilesModel.editedItemIndex, true);
        },
        priorityDecrease: function () {
          this.sortableTilesModel.reprioritizeItem(this.sortableTilesModel.editedItemIndex, false);
        },
        close: function () {
          this.sortableTilesModel.editingMode = false;
        }
      });
    })();
  </script>
</polymer-element>